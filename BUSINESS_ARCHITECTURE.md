# CCLEMON 業務與領域架構

## 1. 專案定位

- 專案型態：個人 side project
- 核心主題：
  - 以「個人健康／飲食／運動管理」為主的量化自我（Quantified Self）平台
  - 結合使用者行為事件收集與即時／離線分析
- 目標：
  - 讓開發者本人可以實際記錄每日飲食、運動與體重
  - 為未來履歷或分享提供一個「具備完整身分驗證、設定中心、事件匯流排」的展示案例

## 2. 業務領域概觀

整體可以拆成三大業務面向：

1. **帳號與身分管理領域**
   - 負責使用者身分、登入流程、Token 發行與驗證基礎
2. **健康／飲食／運動領域**
   - 負責紀錄個人的健康相關資料與目標
3. **行為事件與分析領域**
   - 負責收集使用者操作事件，並進行統計、分析或觸發後續流程
4. **系統設定與營運支援領域**
   - 負責系統營運參數、多語系設定、設定稽核等

下列段落會以「模組在業務上的角色」來說明上述領域如何具體落地。

## 3. 各模組在業務上的角色

### 3.1 `cclemon-auth`：帳號中心與授權服務

- 所屬領域：帳號與身分管理
- 業務角色：
  - 作為整個系統的「帳號中心」，統一處理使用者登入／登出
  - 提供：
    - 平台自有帳號密碼登入
    - Google OAuth2 登入，降低註冊門檻
  - 為下游所有服務發行 Access Token（JWT），成為權限與身分的權威來源
- 實際價值：
  - 即使只是一人使用，也能展示企業級的 SSO 與授權設計
  - 未來若擴展成對外產品，可以輕易支援多使用者、多 Client App

### 3.2 `cclemon-health`：個人健康管理核心服務

- 所屬領域：健康／飲食／運動
- 業務角色：
  - 管理個人健康相關的核心資料：
    - 使用者健康目標：
      - 目標卡路里（`targetCalorie`）
      - 目標體重（`targetWeight`）
    - 運動管理：
      - `Exercise`：可自定義運動項目、單位與每單位卡路里
      - `DailyExercise`：每日做了哪些運動、多少次、哪一天
    - 飲食管理：
      - `Food`：食物的卡路里與營養素（碳水、蛋白質、脂肪、糖等）
      - `DailyFood`：每日吃了什麼、在什麼時間（早餐／午餐／晚餐／點心）、幾份
    - 身體資訊管理：
      - `DailyInfo`：每天的體重與照片路徑，用於追蹤體重與體態變化
  - 對外提供 API：
    - 新增／查詢／更新／刪除上述資料
    - 查詢某一天或某一段期間的健康紀錄與彙總資訊（可逐步擴充）
- 對個人使用情境的價值：
  - 可以每天實際記錄自己的飲食、運動與體重
  - 為後續做統計圖表、趨勢分析提供資料基礎

### 3.3 `cclemon-userEvent`：使用者行為事件入口

- 所屬領域：行為事件與分析
- 業務角色：
  - 提供一個統一的 HTTP 入口（`POST /user-events`）接收前端或其他服務上報的事件
  - 事件類型可以彈性定義，例如：
    - 使用者開啟 App／進入某頁面
    - 點擊某個功能按鈕（例如「新增飲食紀錄」）
    - 完成某項任務（例如連續 7 天有紀錄體重）
  - 收到事件後，立即轉發到 Kafka topic，交由後端其他服務進一步處理
- 實際應用例子：
  - 記錄「自己怎麼使用這個健康 App」的行為軌跡
  - 之後可以分析哪些功能最常被使用、在哪些時間最常操作

### 3.4 `cclemon-eventBus`：事件處理與整合服務

- 所屬領域：行為事件與分析
- 業務角色：
  - 從 Kafka 接收來自 `cclemon-userEvent` 或其他服務的事件
  - 根據事件內容進行：
    - 儲存到事件紀錄表（事件日誌）
    - 累計統計數據（例如每日事件數、功能使用次數）
    - 觸發後續流程（例如通知、提醒、成就解鎖）
- 發展方向：
  - 初期可以先只做事件落庫與簡單統計
  - 之後可擴充為：
    - 行為驅動的提醒系統（例如超過幾天未紀錄飲食就發提醒）
    - 成就／徽章系統的事件來源

### 3.5 `cclemon-stream`：即時分析與統計

- 所屬領域：行為事件與分析
- 業務角色：
  - 從 Kafka 事件流中即時做彙整與轉換
  - 典型應用：
    - 計算「最近 7 天／30 天」的事件平均數或累積值
    - 即時計算健康相關 KPI（例如連續打卡天數、連續達標天數）
- 雖然目前尚未實作詳細拓樸，但業務定位是：
  - 提供「即時評估」能力，補足單純離線報表的不足

### 3.6 `cclemon-data`：系統設定與營運支援

- 所屬領域：系統設定與營運支援
- 業務角色：
  - 儲存各種「可配置」的營運與產品參數，例如：
    - 健康建議門檻（例如：每日卡路里建議值）
    - 提示與說明文案（可多語系）
    - 功能開關或實驗（feature flags）
  - `ConfigValueAudit` 支援設定變更紀錄，有助於回溯問題與符合一定治理需求

### 3.7 `cclemon-config-server`：設定中心

- 所屬領域：系統設定與營運支援
- 業務角色：
  - 對外提供設定查詢 API，讓各服務在啟動或運行時取得最新設定
  - 可配合 `@RefreshScope` 達成「不重啟服務即可套用新設定」

### 3.8 `cclemon-logging`

- 所屬領域：系統營運支援
- 業務角色：
  - 提供統一的 log 格式與規則
  - 讓未來若要把 log 匯入 ELK / Loki / Cloud Logging，更容易查詢與分析

### 3.9 `cclemon-practice`

- 所屬領域：不屬於正式業務領域（個人學習）
- 業務角色：
  - 作為個人測試與學習的空間，不影響正式核心功能

## 4. 典型使用情境（以個人健康管理為例）

以下是一個典型「自己使用 CCLEMON」的一天流程：

1. **登入系統**
   - 使用自己的帳號密碼或 Google 登入（由 `cclemon-auth` 處理）
   - 前端拿到 Access Token，後續呼叫各後端服務

2. **建立與維護健康目標**
   - 在前端設定目標體重與每日目標卡路里
   - 前端呼叫 `cclemon-health` API，儲存在 `CclemonUser` 中

3. **定義常用飲食與運動項目**
   - 建立常吃的食物（例如某款便當、飲料）及其營養值
   - 建立常做的運動（例如跑步 1 公里、重訓 1 組）及消耗卡路里

4. **每天紀錄**
   - 每吃一餐就新增 `DailyFood` 紀錄
   - 每運動一次就新增 `DailyExercise` 紀錄
   - 每天量完體重後新增 `DailyInfo` 紀錄（可附體態照片路徑）

5. **行為事件上報與分析**
   - 每次在前端完成新增／更新紀錄時，同步呼叫 `cclemon-userEvent` 上報事件
   - 事件寫入 Kafka 後，由 `cclemon-eventBus` 或 `cclemon-stream` 彙整
   - 日後可查詢自己：
     - 哪些功能最常用
     - 自己在什麼時間最常紀錄飲食／體重

6. **檢視結果與反饋（未來可擴充）**
   - 前端呼叫 `cclemon-health` 查詢近一週／一個月的體重變化與卡路里統計
   - 可根據事件統計結果顯示：
     - 連續打卡天數
     - 使用最頻繁的功能

## 5. 未來業務擴充方向

- **健康建議與提醒**：
  - 依據每日攝取與消耗，自動計算是否超出建議範圍
  - 發出「多喝水」「今天還差多少卡路里才達標」等提醒
- **成就與遊戲化機制**：
  - 依照事件（例如連續 7 天記錄、達標天數）給予徽章與成就
- **對外分享／報表**：
  - 匯出個人健康資料為 CSV／圖表，或產生可分享的周／月報
- **支援多使用者或小型團體**：
  - 讓朋友或家人也能用同一套系統，各自有帳號與健康紀錄

> 本檔案僅描述「業務與領域」觀點；關於技術細節與模組實作請參考 `TECH_ARCHITECTURE.md`。